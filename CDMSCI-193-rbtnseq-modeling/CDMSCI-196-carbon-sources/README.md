# CDMSCI-196: Compile Carbon Sources List

**Parent**: CDMSCI-193 - RBTnSeq Modeling Analysis

## Objective

Create a comprehensive, high-quality organism × carbon source growth matrix for metabolic model validation by integrating:
1. Gold standard curated data from BigFIT paper (Price et al. 2018)
2. Additional growth data from Fitness Browser database

## Data Sources

### Tier 1: Supplementary Table S2 (Gold Standard)
- **Paper**: Price et al. (2018) Nature 557:503-509
- **URL**: https://genomics.lbl.gov/supplemental/bigfit/Supplementary_Tables_final.xlsx
- **Coverage**: 28 organisms × 94 carbon sources
- **Quality**: Curated, peer-reviewed growth/no-growth calls
- **Use for**: BOTH growth and no-growth calls

### Tier 2: Fitness Browser Database (Secondary)
- **Database**: feba.db from https://fit.genomics.lbl.gov
- **Coverage**: 57 organisms × 198 carbon sources
- **Quality**: All experiments pass gMed >= 50, mad12 <= 0.5
- **Use for**: Growth calls ONLY (if experiment exists → growth occurred)
- **Important**: Do NOT assume absence of data means "No Growth"

## Data Strategy (Tiered Approach)

**Why this strategy?**
- 287 cases where Supplementary Table shows growth but Fitness Browser has no data
- Missing data could mean: never tested, failed experiment, or not published
- Only Supplementary Table provides definitive "No Growth" calls

**Implementation**:
1. Start with Supplementary Table S2 (use both Growth and No Growth calls)
2. Add additional Growth calls from Fitness Browser
3. Leave remaining cells blank (unknown/not tested)

See `results/DATA_STRATEGY.md` for complete rationale.

## Reproducible Workflow

All data files are generated by running these 4 Jupyter notebooks in sequence:

### 1. Download Gold Standard Data
**File**: `01-download-supplementary-table-s2.ipynb`

**What it does**:
- Downloads Supplementary Tables from BigFIT paper
- Extracts Table S2 (Carbon sources)
- Cleans and formats growth/no-growth data
- Creates organism name mappings

**Outputs**:
- `results/supplementary_table_s2_clean.csv`
- `results/supplementary_table_s2_carbon.csv`
- `results/organism_name_mapping_supplementary_to_FIT.csv`

### 2. Extract Organism Metadata
**File**: `02-extract-organism-metadata.ipynb`

**What it does**:
- Connects to Fitness Browser database (feba.db)
- Extracts organism metadata (taxonomy, IDs)
- Creates cross-reference table

**Outputs**:
- `results/organism_metadata.csv`

**Columns**:
- orgId, Full_Species_Name, NCBI_TaxID
- division, genus, species, strain
- Species_Name (simple format)

### 3. Create Combined Growth Matrix
**File**: `03-create-combined-growth-matrix.ipynb`

**What it does**:
- Integrates Tier 1 and Tier 2 data
- Implements tiered data strategy
- Creates master growth matrix

**Outputs**:
- `results/combined_growth_matrix.csv`

**Values**:
- `Growth` - Confirmed growth (from either source)
- `No Growth` - Confirmed no growth (from Supplementary Table ONLY)
- ` ` (blank) - Unknown/not tested

### 4. Analyze Data Discrepancies
**File**: `04-analyze-data-discrepancies.ipynb`

**What it does**:
- Identifies conflicts between data sources
- Documents 290 discrepancies
- Validates tiered data strategy

**Outputs**:
- `results/data_source_discrepancies.csv`

**Discrepancy types**:
- `FB_NoData_Supp_Growth` (287 cases): Fitness Browser has no data, Supp shows growth
- `FB_Growth_Supp_NoGrowth` (3 cases): Direct contradiction (trust Supp Table)

## How to Run

```bash
# Start Jupyter
jupyter notebook

# Run notebooks in order:
# 1. 01-download-supplementary-table-s2.ipynb
# 2. 02-extract-organism-metadata.ipynb
# 3. 03-create-combined-growth-matrix.ipynb
# 4. 04-analyze-data-discrepancies.ipynb
```

## Output Files

### Primary Data Files

1. **supplementary_table_s2_clean.csv**
   - 28 organisms × 94 carbon sources
   - Values: "Growth" / "No Growth"
   - Gold standard for validation
   - Column names: Species names (e.g., "Escherichia coli BW25113")

2. **combined_growth_matrix.csv**
   - 57 organisms × 206 carbon sources
   - Values: "Growth" / "No Growth" / blank (no data)
   - Integrates both data sources with proper hierarchy
   - Column names: Species names

3. **organism_metadata.csv**
   - Reference table with all organism information
   - Links: orgId ↔ Species_Name ↔ NCBI_TaxID
   - Use for cross-referencing between datasets

### Supporting Files

4. **data_source_discrepancies.csv**
   - Documents 290 cases where sources disagree
   - Most (287): Fitness Browser has no data, Supp shows growth
   - Few (3): Fitness Browser shows growth, Supp shows no growth

5. **DATA_STRATEGY.md**
   - Comprehensive data usage guidelines
   - Explains tiered approach
   - Interpretation guide for Growth/No Growth/blank
   - Recommended test set for model validation

6. **DATA_INTEGRATION_REPORT.md**
   - Detailed analysis of data integration
   - Quality filter investigation
   - Carbon source matching results

7. **FILE_NAMING_SUMMARY.md**
   - Documents naming conventions across all files
   - Cross-referencing guide

## Usage for Downstream Tasks

### For CDMSCI-199 (FBA Model Validation)

**Recommended test set**: Use `supplementary_table_s2_clean.csv`

```python
import pandas as pd

# Load gold standard data
gold_standard = pd.read_csv('results/supplementary_table_s2_clean.csv', index_col=0)

# 2,408 usable comparisons for validation:
# - 28 organisms × 86 carbon sources (overlap with your data)
# - 931 confirmed growth cases
# - 1,477 confirmed no-growth cases

# Compare with in silico FBA predictions
# confusion_matrix = compare(gold_standard, fba_predictions)
```

**Metrics to calculate**:
1. True Positive Rate (TPR): Model predicts growth AND gold standard confirms growth
2. False Negative Rate (FNR): Model predicts no growth BUT gold standard shows growth
3. True Negative Rate (TNR): Model predicts no growth AND gold standard confirms no growth
4. False Positive Rate (FPR): Model predicts growth BUT gold standard shows no growth

**Important**: "No Growth" threshold is conservative - some FPs might grow under different conditions.

### For CDMSCI-197 (Media Formulations)

```python
import pandas as pd

# Load combined matrix to get all carbon sources
combined = pd.read_csv('results/combined_growth_matrix.csv', index_col=0)

# Get list of all carbon sources
carbon_sources = combined.index.tolist()
print(f"Total carbon sources to map: {len(carbon_sources)}")

# Map to ModelSEED compounds (next step)
# ... proceed to CDMSCI-197
```

## Key Findings

### 1. Quality Filters Not the Issue
- ALL 8,975 experiments in feba.db already pass quality thresholds
- Morgan's team pre-filtered the database before publishing
- 100% pass rate for gMed >= 50, mad12 <= 0.5

### 2. Supplementary Table Has Additional Data
- 287 growth cases exist in supplementary table but NOT in feba.db
- These experiments were conducted but not included in public database
- May be from different experimental setups or pre-publication data

### 3. Cannot Assume Absence = No Growth
- Missing data could mean: untested, failed experiment, or low quality data
- Only supplementary table provides definitive "No Growth" calls
- This validates our tiered data strategy

## Validation Metrics

### Recommended Test Set (from Supplementary Table S2)
- **Organisms**: 28 (all overlap with Fitness Browser)
- **Carbon sources**: 86 (overlap with available data)
- **Total comparisons**: 2,408
- **Growth cases**: 931
- **No-growth cases**: 1,477
- **Coverage**: High-confidence data for robust validation

### Data Quality
- **Gold standard**: Curated by Morgan Price's team
- **Peer-reviewed**: Published in Nature (2018)
- **Conservative**: "No Growth" threshold may miss alternative conditions
- **Reliable**: All experiments meet quality standards

## Interpretation Guide

### "Growth"
**Meaning**: Organism confirmed to grow on this carbon source
**Confidence**: High
**Sources**: Supplementary table (curated) OR Fitness Browser (experiment exists)

### "No Growth"
**Meaning**: Organism did NOT grow under tested conditions
**Confidence**: Medium (conservative threshold)
**Sources**: Supplementary table ONLY
**Note**: Alternative conditions (different concentrations, base media) might support growth

### Blank / Empty
**Meaning**: Unknown - not tested or no reliable data
**Confidence**: N/A
**Sources**: Neither source has data

## Status

- [x] Notebook 01: Download supplementary table
- [x] Notebook 02: Extract organism metadata
- [x] Notebook 03: Create combined growth matrix
- [x] Notebook 04: Analyze data discrepancies
- [x] All data files generated and validated
- [x] Data strategy documented
- [x] Naming consistency verified
- [x] Ready for CDMSCI-197 and CDMSCI-199

## Next Steps

1. **CDMSCI-197**: Map carbon sources to ModelSEED media formulations
2. **CDMSCI-198**: Build genome-scale metabolic models for organisms
3. **CDMSCI-199**: Run FBA simulations and validate against gold standard

## References

- Price MN et al. (2018) Mutant phenotypes for thousands of bacterial genes of unknown function. Nature 557:503-509
- Fitness Browser: https://fit.genomics.lbl.gov
- BigFIT Supplementary Tables: https://genomics.lbl.gov/supplemental/bigfit/

## Last Updated

2025-10-06
