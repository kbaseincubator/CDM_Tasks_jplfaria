# CDMSCI-196: Compile Carbon Sources List

**Parent**: CDMSCI-193 - RBTnSeq Modeling Analysis

## Objective

Create a comprehensive, high-quality organism × carbon source growth matrix for metabolic model validation by integrating:
1. Curated growth/no-growth data from BigFIT paper (Price et al. 2018)
2. Additional growth data from Fitness Browser database

## Data Sources

### Tier 1: Supplementary Table S2 (2018 Paper)
- **Paper**: Price et al. (2018) Nature 557:503-509
- **URL**: https://genomics.lbl.gov/supplemental/bigfit/Supplementary_Tables_final.xlsx
- **Coverage**: 28 organisms × 94 carbon sources
- **Quality**: Curated, peer-reviewed growth/no-growth calls
- **Use for**: BOTH growth and no-growth calls

### Tier 2: Fitness Browser Database (Secondary)
- **Database**: feba.db from https://fit.genomics.lbl.gov
- **Coverage**: 57 organisms × 198 carbon sources
- **Quality**: All experiments pass gMed >= 50, mad12 <= 0.5
- **Use for**: Growth calls ONLY (if experiment exists → growth occurred)
- **Important**: Do NOT assume absence of data means "No Growth"

## Data Strategy (Tiered Approach)

**Why this strategy?**
- 170 cases where Supplementary Table shows growth but Fitness Browser has no data
- Missing data could mean: never tested, failed experiment, or not published
- Only Supplementary Table provides definitive "No Growth" calls

**Implementation**:
1. Start with Supplementary Table S2 (use both Growth and No Growth calls)
2. Add additional Growth calls from Fitness Browser
3. Leave remaining cells blank (unknown/not tested)

See `results/DATA_STRATEGY.md` for complete rationale.

## Reproducible Workflow

All data files are generated by running these 5 Jupyter notebooks in sequence:

### 1. Download 2018 Paper Data
**File**: `01-download-supplementary-table-s2.ipynb`

**What it does**:
- Downloads Supplementary Tables from BigFIT paper
- Extracts Table S2 (Carbon sources)
- Cleans and formats growth/no-growth data
- Creates organism name mappings

**Outputs**:
- `results/supplementary_table_s2_clean.csv`
- `results/supplementary_table_s2_carbon.csv`
- `results/organism_name_mapping_supplementary_to_FIT.csv`

### 2. Extract Organism Metadata
**File**: `02-extract-organism-metadata.ipynb`

**What it does**:
- Connects to Fitness Browser database (feba.db)
- Extracts organism metadata (taxonomy, IDs)
- Creates cross-reference table

**Outputs**:
- `results/organism_metadata.csv`

**Columns**:
- orgId, Full_Species_Name, NCBI_TaxID
- division, genus, species, strain
- Species_Name (simple format)

### 3. Create Combined Growth Matrix
**File**: `03-create-combined-growth-matrix.ipynb`

**What it does**:
- Integrates Tier 1 and Tier 2 data
- Implements tiered data strategy
- Creates master growth matrix

**Outputs**:
- `results/combined_growth_matrix.csv`

**Values**:
- `Growth` - Confirmed growth (from either source)
- `No Growth` - Confirmed no growth (from Supplementary Table ONLY)
- ` ` (blank) - Unknown/not tested

### 4. Analyze Data Discrepancies
**File**: `04-analyze-data-discrepancies.ipynb`

**What it does**:
- Identifies conflicts between data sources
- Documents 173 discrepancies
- Validates tiered data strategy

**Outputs**:
- `results/data_source_discrepancies.csv`

**Discrepancy types**:
- `FB_NoData_Supp_Growth` (170 cases): Fitness Browser has no data, Supp shows growth
- `FB_Growth_Supp_NoGrowth` (3 cases): Direct contradiction (Tier 1 takes precedence)

### 5. Evaluate Carbon Sources for Modeling
**File**: `05-evaluate-carbon-sources-for-modeling.ipynb`

**What it does**:
- Two-tier LLM evaluation of carbon sources for metabolic modeling
- Step 1: GPT-4o comprehensive analysis (all 207 compounds)
- Step 2: GPT-5 deep dive (manual review cases only)
- Categorizes: simple_metabolite, polymer, complex_mixture, proprietary, unclear
- Recommendations: use, use_monomer, use_alternative, exclude

**Outputs**:
- `results/carbon_source_evaluation_gpt4o.csv`
- `results/carbon_source_evaluation_gpt5.csv`
- `results/carbon_source_evaluation_final.csv`

**Why this step?**
- Not all experimental carbon sources are suitable for metabolic modeling
- Filters out proprietary blends, complex mixtures, polymers
- Provides curated list for CDMSCI-197 (ModelSEED mapping)

## How to Run

```bash
# Start Jupyter
jupyter notebook

# Run notebooks in order:
# 1. 01-download-supplementary-table-s2.ipynb
# 2. 02-extract-organism-metadata.ipynb
# 3. 03-create-combined-growth-matrix.ipynb
# 4. 04-analyze-data-discrepancies.ipynb
# 5. 05-evaluate-carbon-sources-for-modeling.ipynb
```

## Output Files

### Primary Data Files

1. **supplementary_table_s2_clean.csv**
   - 28 organisms × 94 carbon sources
   - Values: "Growth" / "No Growth"
   - Curated validation dataset from 2018 paper
   - Column names: Species names (e.g., "Escherichia coli BW25113")

2. **combined_growth_matrix.csv**
   - 57 organisms × 208 carbon sources = 11,856 total cells
   - Values: "Growth" / "No Growth" / blank (no data)
   - Growth: 1,256 (10.6%)
   - No Growth: 1,331 (11.2%)
   - Unknown: 9,269 (78.2%)
   - Integrates both data sources with proper hierarchy
   - Column names: Species names

3. **organism_metadata.csv**
   - Reference table with all organism information
   - Links: orgId ↔ Species_Name ↔ NCBI_TaxID
   - Use for cross-referencing between datasets

### Carbon Source Evaluation Files

4. **carbon_source_evaluation_final.csv**
   - Curated list of carbon sources suitable for metabolic modeling
   - Recommendations: use, use_monomer, use_alternative, exclude
   - LLM-evaluated categories: simple_metabolite, polymer, proprietary, complex_mixture
   - Use this file in CDMSCI-197 for ModelSEED mapping

5. **carbon_source_evaluation_gpt4o.csv**
   - Full GPT-4o analysis of all 207 compounds
   - Fast comprehensive categorization

6. **carbon_source_evaluation_gpt5.csv**
   - GPT-5 deep dive for manual review cases
   - Extended reasoning with database references

### Supporting Files

7. **data_source_discrepancies.csv**
   - Documents 173 cases where sources disagree
   - Most (170): Fitness Browser has no data, Supp shows growth
   - Few (3): Fitness Browser shows growth, Supp shows no growth (Tier 1 takes precedence)

8. **DATA_STRATEGY.md**
   - Comprehensive data usage guidelines
   - Explains tiered approach
   - Interpretation guide for Growth/No Growth/blank
   - Recommended test set for model validation

9. **DATA_INTEGRATION_REPORT.md**
   - Detailed analysis of data integration
   - Quality filter investigation
   - Carbon source matching results

10. **FILE_NAMING_SUMMARY.md**
    - Documents naming conventions across all files
    - Cross-referencing guide

## Usage for Downstream Tasks

### For CDMSCI-199 (FBA Model Validation)

**Recommended test set**: Use `supplementary_table_s2_clean.csv`

```python
import pandas as pd

# Load curated validation data
validation_data = pd.read_csv('results/supplementary_table_s2_clean.csv', index_col=0)

# 2,408 usable comparisons for validation:
# - 28 organisms × 86 carbon sources (overlap with your data)
# - 931 confirmed growth cases
# - 1,477 confirmed no-growth cases

# Compare with in silico FBA predictions
# confusion_matrix = compare(validation_data, fba_predictions)
```

**Metrics to calculate**:
1. True Positive Rate (TPR): Model predicts growth AND experimental data confirms growth
2. False Negative Rate (FNR): Model predicts no growth BUT experimental data shows growth
3. True Negative Rate (TNR): Model predicts no growth AND experimental data confirms no growth
4. False Positive Rate (FPR): Model predicts growth BUT experimental data shows no growth

**Important**: "No Growth" threshold is conservative - some FPs might grow under different conditions.

### For CDMSCI-197 (Media Formulations)

**Use the curated evaluation list** to focus on suitable carbon sources:

```python
import pandas as pd

# Load evaluated carbon sources (recommended)
evaluation = pd.read_csv('results/carbon_source_evaluation_final.csv')

# Filter for suitable compounds only
suitable = evaluation[evaluation['Recommendation'].isin(['use', 'use_monomer', 'use_alternative'])]
print(f"Suitable carbon sources to map: {len(suitable)}")

# Get list of carbon sources to map to ModelSEED
carbon_sources_to_map = suitable['Carbon_Source'].tolist()

# For 'use_monomer', use the suggested alternative
# For 'use_alternative', use the suggested compound
# For 'use', use as-is
```

**Why use the evaluation?**
- Filters out proprietary blends (e.g., Actilight, Bimuno)
- Excludes complex mixtures (e.g., casamino acids)
- Suggests monomers for polymers (e.g., Amylose → Glucose)
- Saves time by focusing on ~144 suitable compounds instead of all 207

## Key Findings

### 1. Quality Filters Not the Issue
- ALL 8,975 experiments in feba.db already pass quality thresholds
- Morgan's team pre-filtered the database before publishing
- 100% pass rate for gMed >= 50, mad12 <= 0.5

### 2. Supplementary Table Has Additional Data
- 170 growth cases exist in supplementary table but NOT in feba.db
- These experiments were conducted but not included in public database
- May be from different experimental setups or pre-publication data

### 3. Cannot Assume Absence = No Growth
- Missing data could mean: untested, failed experiment, or low quality data
- Only supplementary table provides definitive "No Growth" calls
- This validates our tiered data strategy

## Validation Metrics

### Recommended Test Set (from Supplementary Table S2)
- **Organisms**: 28 (all overlap with Fitness Browser)
- **Carbon sources**: 86 (overlap with available data)
- **Total comparisons**: 2,408
- **Growth cases**: 931
- **No-growth cases**: 1,477
- **Coverage**: High-confidence data for robust validation

### Data Quality
- **Curated data**: Both sources from Morgan Price's team (equally trustworthy)
- **Peer-reviewed**: 2018 paper published in Nature
- **Conservative**: "No Growth" threshold may miss alternative conditions
- **Difference**: Paper reports Growth AND No Growth; Database reports Growth only

## Interpretation Guide

### "Growth"
**Meaning**: Organism confirmed to grow on this carbon source
**Confidence**: High
**Sources**: Supplementary table (curated) OR Fitness Browser (experiment exists)

### "No Growth"
**Meaning**: Organism did NOT grow under tested conditions
**Confidence**: Medium (conservative threshold)
**Sources**: Supplementary table ONLY
**Note**: Alternative conditions (different concentrations, base media) might support growth

### Blank / Empty
**Meaning**: Unknown - not tested or no reliable data
**Confidence**: N/A
**Sources**: Neither source has data

## Status

- [x] Notebook 01: Download supplementary table
- [x] Notebook 02: Extract organism metadata
- [x] Notebook 03: Create combined growth matrix
- [x] Notebook 04: Analyze data discrepancies
- [x] Notebook 05: Evaluate carbon sources for modeling
- [x] All data files generated and validated
- [x] Data strategy documented
- [x] Naming consistency verified
- [x] Carbon source evaluation complete
- [x] Ready for CDMSCI-197 and CDMSCI-199

## Next Steps

1. **CDMSCI-197**: Map curated carbon sources to ModelSEED media formulations (use evaluation results)
2. **CDMSCI-198**: Build genome-scale metabolic models for organisms
3. **CDMSCI-199**: Run FBA simulations and validate against experimental data

## References

- Price MN et al. (2018) Mutant phenotypes for thousands of bacterial genes of unknown function. Nature 557:503-509
- Fitness Browser: https://fit.genomics.lbl.gov
- BigFIT Supplementary Tables: https://genomics.lbl.gov/supplemental/bigfit/

## Last Updated

2025-10-15
